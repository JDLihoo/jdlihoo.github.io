---
title: A-Ops安装使用
author: JDLihoo
date: 2026-01-08
category: Jekyll
layout: post
published: false
---
## 生成patch
这里是对master分支和dlh分支进行了对比：
git format-patch master..dlh --stdout > 0001-fixbug-disruption_detector.patch

## 准备源码包
### 如果没有原有版本的tar包进行：
```
yum install -y rpm-build rpmdevtools python3-devel gcc

cd /home/atomgit/gala-anteater/
rm -rf build/
rm -rf gala_anteater.egg-info/

mkdir -p /tmp/rpm-rebuild/gala-anteater-1.2.2
cp -rp /home/atomgit/gala-anteater/* /tmp/rpm-rebuild/gala-anteater-1.2.2/
cd /tmp/rpm-rebuild/
tar -czvf gala-anteater-1.2.2.tar.gz gala-anteater-1.2.2/
# 后续删掉/tmp/gala-anteater-1.2.2/

cp gala-anteater-1.2.2.tar.gz /home/atomgit/src-openeuler/src-openeuler-gala-anteater/
cp gala-anteater-1.2.2.tar.gz ~/rpmbuild/SOURCES/
```
### 有原有的tar包，则直接cp到~/rpmbuild/SOURCES/
```
cp /home/atomgit/src-openeuler/src-openeuler-gala-anteater/gala-anteater-1.2.2.tar.gz ~/rpmbuild/SOURCES/
```

## 手动修改spec文件
Release 加一

把patch加上

新增changelog

## 使用rpmbuild构建
```
# 生成标准的RPM工作目录结构
rpmdev-setuptree

rm -rf ~/rpmbuild/SOURCES/*
cp /home/atomgit/src-openeuler/src-openeuler-gala-anteater/gala-anteater-1.2.2.tar.gz ~/rpmbuild/SOURCES/
cp /home/atomgit/src-openeuler/src-openeuler-gala-anteater/gala-anteater.yaml ~/rpmbuild/SOURCES/
cp /home/atomgit/src-openeuler/src-openeuler-gala-anteater/0001-fixbug-disruption_detector.patch ~/rpmbuild/SOURCES/
cp /home/atomgit/src-openeuler/src-openeuler-gala-anteater/gala-anteater.spec ~/rpmbuild/SPECS/

cd ~/rpmbuild/SPECS/
dnf builddep gala-anteater.spec 
rpmbuild -ba gala-anteater.spec
```

## 获取结果
构建成功后，生成的二进制 RPM 包将位于： ~/rpmbuild/RPMS/noarch/ 或 ~/rpmbuild/RPMS/x86_64/

## 安装RPM包
```
cd /root/rpmbuild/RPMS/x86_64

# 使用 dnf 或 rpm 安装（dnf 会自动处理依赖）
rpm -ivh --nodeps gala-anteater-1.2.2-2.x86_64.rpm python3-gala-anteater-1.2.2-2.x86_64.rpm

rpm -ql gala-anteater
```

## 卸载RPM包
```
systemctl stop gala-anteater
systemctl disable gala-anteater
rpm -e gala-anteater
rpm -e python3-gala-anteater
```