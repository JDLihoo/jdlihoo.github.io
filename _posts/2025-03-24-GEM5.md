---
title: GEM5
author: JDLihoo
date: 2025-03-24
category: Jekyll
layout: post
---

# GEM5
## 编译
```
scons build/X86/gem5.opt -j80
```

## 单机运行调试
```
sudo gdb --args ./build/X86/gem5.opt -d m5out/fs-nvp configs/deprecated/example/fs_nvp.py --cpu-type=X86KvmCPU --kernel=$M5_PATH/binaries/x86-linux-kernel-5.4.49 --disk-image=$M5_PATH/disks/x86-ubuntu-18.04-img --energy-time-unit='100us' --thres-high=900000000 --thres-low=100000000 --capacity=1000000000
```


## ARM机器
磁盘镜像挂载：
```
# sudo apt-get install qemu-utils
# sudo modprobe nbd max_part=8
cd gem5-stable/full_system/disks
sudo qemu-nbd -c /dev/nbd0 arm64-ubuntu-20.04-img
sudo fdisk -l /dev/nbd0
sudo mount /dev/nbd0p1 ./mnt
sudo mount --bind /proc ./mnt/proc
sudo mount --bind /dev ./mnt/dev
sudo chroot ./mnt

# 挂载后可通过scp在主机和磁盘镜像之间传输数据
scp -r gem5-stable/full_system/disks/arm64-ubuntu-20.04-img root@[ip addr]:[file path]

# 退出磁盘镜像
exit
sudo umount ./mnt/proc
sudo umount ./mnt/dev
sudo umount ./mnt
sudo qemu-nbd -d /dev/nbd0
```
调试：
```
export LD_LIBRARY_PATH=/lib/aarch64-linux-gnu:/usr/lib/aarch64-linux-gnu:$LD_LIBRARY_PATH
gdb --args ...
```

[1]: https://pages.github.com